#!/usr/bin/env bash
set -e

filename="${1-main.py}"

# This is a wrapper script for atcoder-cli's submit command.
# Checks import statement which you can't use in AtCoder Python environment

if ggrep -P -e '^(from|import) (combination|deletable(_max)?_heapq|lca|pt|union_find(_dict)?)\b' $filename
then
  echo 'Check the following line'
  exit 1
fi

if ggrep -e sys.setrecursionlimit -e 'import numpy' -e 'cpython' -e ':=' -q $filename
then
  if ggrep -q pypyjit $filename
  then
    interpreter=pypy
  else
    interpreter=cpython
  fi
else
  interpreter=pypy
fi

acc s "$filename" -- -y --guess-python-interpreter "$interpreter"
