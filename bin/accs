#!/usr/bin/env bash

filename="${1-main.py}"

# This is a wrapper script for atcoder-cli's submit command.
# Checks import statement which you can't use in AtCoder Python environment

if ggrep -P '^(?!#).*import (UnionFind|Sorted(List|Set|Map))' $filename; then
  echo 'check import statement'
  exit 1
fi

if ggrep -e sys.setrecursionlimit -e 'import numpy' -e 'cpython' -e ':=' -e '@lru_cache' -q $filename
then
  if ggrep -q pypyjit $filename
  then
    interpreter=pypy
  else
    interpreter=cpython
  fi
else
  interpreter=pypy
fi

acc s "$filename" -- -y --guess-python-interpreter "$interpreter"
