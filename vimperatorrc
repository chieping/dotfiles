" vim: set filetype=vim :
" using plugin list {{{
" bookmarktoolbar-hint.js
" migemo_find.js
" forcefocuscontent.js
" lookupDictionary.js
" caret-hint.js
" walk-input.js
" }}}

let mapleader=","

set showstatuslinks=1
set status=location
set titlestring=""
set hintchars=fjklasdhguionmerv
set smartcase

" Show hint with no any label or value on input elements
set hintinputs=""

nnoremap <Leader>r :source ~/.vimperatorrc<CR>:echomsg "Reload vimperatorrc"<CR>

" Open dictionary with command-line-buffer (depends on lookupDictionary.js)
" Note that bracket-surrounded means allowing conjugated form
nnoremap <Leader>a Y:eijiro [<M-v>]<CR>
vnoremap <Leader>a y:eijiro [<M-v>]<CR>

nnoremap <Leader>ta :set gui=invaddons<CR>:echomsg "Toggle addons"<CR>
nnoremap <Leader>tt :set gui=invtabs<CR>:echomsg "Toggle tabs"<CR>
nnoremap <Leader>tn :set gui=invnavigation<CR>:echomsg "Toggle navigation"<CR>
nnoremap <Leader>tb :set gui=invbookmarks<CR>:echomsg "Toggle bookmarks"<CR>
nnoremap <Leader>tm :set gui=invmenu<CR>:echomsg "Toggle menu"<CR>
nnoremap <Leader>tc :set gui=none<CR>

noremap <M-f> /
cnoremap <M-f> <C-u>\
inoremap <M-f> <ESC>/

nnoremap d :tabclose -select lastactive<CR>

" clone tab
nnoremap c :tabduplicate<CR>

nnoremap C c

nnoremap j 6j
nnoremap k 6k

nnoremap h gT
nnoremap l gt

nnoremap H 3h
nnoremap L 3l

inoremap <Home> <C-a>
inoremap <End>  <C-e>

inoremap <C-h> <Left>
inoremap <C-l> <Right>

cnoremap <C-h> <Left>
cnoremap <C-l> <Right>

nnoremap ^ +

vnoremap P <Esc><Esc>P
vnoremap p <Esc><Esc>p
vnoremap <CR> y<Esc><Esc>P

" yank and back to normal mode
vnoremap y y<Esc><Esc>:echomsg "Yanked <M-v>"<CR>
vnoremap <CR> y<Esc><Esc>:echomsg "Yanked <M-v>"<CR>

" depend on caret-hint.js
nnoremap <C-t> ;c

" for preventing unintended completion, specify google search
noremap o og<Space>
noremap t tg<Space>

cabbrev a    eijiro
cabbrev e    wiktionaryen

" Anchor
nnoremap ya :js util.copyToClipboard('<a href="'+buffer.URL + '">'+ buffer.title + '</a>')<CR>
" Markdown
nnoremap ym :js util.copyToClipboard('['+ buffer.title +']('+ buffer.URL +')')<CR>
" Backlog
nnoremap yb :js util.copyToClipboard('[['+buffer.title.replace(':','')+'>'+buffer.URL+']]')<CR>
" Simple
nnoremap ys :js util.copyToClipboard(buffer.title +' - '+ buffer.URL)<CR>
nnoremap yt :js util.copyToClipboard(buffer.title)<CR>
nnoremap yu :js util.copyToClipboard(buffer.URL)<CR>

style -name commandline-ime chrome://* #liberator-commandline-command input {ime-mode: inactive;}

" ignore statuspanel
style chrome://* .statuspanel-label {display: none;}

highlight StatusLine color: black; background: transparent; font-weight: normal;
highlight! Hint font-family: "Bitstream Vera Sans Mono",monaco,monospace; font-size: 12px; font-weight: bold; color: white; background-color: green; border-color: ButtonShadow; border-width: 0px; border-style: solid; padding: 2px; line-height: 1em;

" TODO: 未完成、というか他の英英辞書を探す？
js <<EOM
  liberator.globalVariables.lookupDictionary_site_definition = [
    {
      names: ['wiktionaryen'],
      url: 'http://en.wiktionary.org/wiki/%s',
      shortHelp: 'Wiktionary en',
      multi: false,
      xpath: 'TODO',
    }
  ];
EOM

" Make Vimperator's "Y"ank behave like Edit-Copy
" http://phaseportrait.blogspot.jp/2008/12/make-vimperators-yank-behave-like-edit.html
js <<EOF
mappings.addUserMap([modes.NORMAL, modes.VISUAL], ["Y"],
    "Yank the currently selected text",
    function () {
        buffer.getCurrentWord();
        events.feedkeys("<C-v>" +
          (/^Mac/.test(navigator.platform) ?
            "<M-c>"
            : "<C-c>"), true);
        setTimeout( function () {
          liberator.echo("Yanked "
                         + util.readFromClipboard(),
                         commandline.FORCE_SINGLELINE);
        }, 20 );
    });
EOF

